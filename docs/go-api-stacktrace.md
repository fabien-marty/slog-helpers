<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# stacktrace

```go
import "github.com/fabien-marty/slog-helpers/pkg/stacktrace"
```

stacktrace.Handler is a slog handler that adds a stack trace to the record \(add attribute or print/write\).

It does not output the log record itself, it decorates another slog.Handler given in the New\(\) method.

The stack trace is added/printed only if the StackTraceEnabled method returns true. The default behavior is to add the stack trace for records with:

- a level greater or equal to slog.LevelError
- \(or\) a boolean attribute add\-stacktrace=true

Note: in the default behavior, the attribute "add\-stacktrace" will be automatically removed by this handler.

The stacktrace can be added as an attribute to the record if the Mode is StackTraceHandlerOptions is ModeAddAttr \(great for JSON format for example\). The stacktrace can be dumped in a writer \(default to stderr\) if the Mode is ModePrint or ModePrintWithColors.

Full example:

```
handler := slog.NewTextHandler(os.Stderr)
stackHandler := New(handler, &Options{
	Mode: ModePrintWithColors,
})
logger := slog.New(stackHandler)
logger.Warn("warning with no stack trace")
logger.Error("this is an error, let's print a stack trace")
logger.Warn("this a warning but with a stack trace", slog.Bool("add-stacktrace", true))
```

## Index

- [Constants](<#constants>)
- [func New\(originalHandler slog.Handler, options \*Options\) slog.Handler](<#New>)
- [type Handler](<#Handler>)
  - [func \(sd \*Handler\) Handle\(context context.Context, record slog.Record\) error](<#Handler.Handle>)
  - [func \(sd \*Handler\) StackTraceEnabled\(context context.Context, record \*slog.Record\) bool](<#Handler.StackTraceEnabled>)
  - [func \(sd \*Handler\) WithAttrs\(attrs \[\]slog.Attr\) slog.Handler](<#Handler.WithAttrs>)
  - [func \(sd \*Handler\) WithGroup\(name string\) slog.Handler](<#Handler.WithGroup>)
- [type Mode](<#Mode>)
- [type Options](<#Options>)


## Constants

<a name="KeyForStackTraceEnabledDefault"></a>KeyForStackTraceEnabledDefault is the key of a boolean attribute to enable the stack trace for log level \< MinimalLevelForStackTraceEnabledEnabled

This behavior can be completely change by overriding the StackTraceEnabled method.

Note: in the default behavior, this attribute will be automatically removed by this handler.

```go
const KeyForStackTraceEnabledDefault = "add-stacktrace"
```

<a name="KeyNameForModeAddAttrDefault"></a>KeyNameForModeAddAttrDefault is the default key name for the ModeAddAttr mode.

```go
const KeyNameForModeAddAttrDefault = "stacktrace"
```

<a name="MinimalLevelForStackTraceEnabledEnabledDefault"></a>MinimalLevelForStackTraceEnabledEnabled is the minimal level for which the stack trace is automatically enabled.

This behavior can be completely change by overriding the StackTraceEnabled method.

```go
const MinimalLevelForStackTraceEnabledEnabledDefault = slog.LevelError
```

<a name="ModeDefault"></a>The default mode of the StackTraceHandler.

```go
const ModeDefault = ModePrint
```

<a name="New"></a>
## func [New](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L79>)

```go
func New(originalHandler slog.Handler, options *Options) slog.Handler
```

New creates a new Handler.

<a name="Handler"></a>
## type [Handler](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L73-L76>)

Handler is a slog handler that adds a stack trace to the record \(add attribute or print/write\).

```go
type Handler struct {
    slog.Handler
    // contains filtered or unexported fields
}
```

<a name="Handler.Handle"></a>
### func \(\*Handler\) [Handle](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L176>)

```go
func (sd *Handler) Handle(context context.Context, record slog.Record) error
```

Handle forwards the call to the original handler \(see constructor\) and adds/prints the stack trace if needed.

<a name="Handler.StackTraceEnabled"></a>
### func \(\*Handler\) [StackTraceEnabled](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L113>)

```go
func (sd *Handler) StackTraceEnabled(context context.Context, record *slog.Record) bool
```

StackTraceEnabled returns true if the stack trace must be added/printed.

The default behavior is to add the stack trace for records with a level greater or equal to slog.LevelError. You can override this method to customize the behavior.

Important note: the behavior of this

<a name="Handler.WithAttrs"></a>
### func \(\*Handler\) [WithAttrs](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L103>)

```go
func (sd *Handler) WithAttrs(attrs []slog.Attr) slog.Handler
```



<a name="Handler.WithGroup"></a>
### func \(\*Handler\) [WithGroup](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L99>)

```go
func (sd *Handler) WithGroup(name string) slog.Handler
```



<a name="Mode"></a>
## type [Mode](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L29>)

Mode is an enumeration type that defines the possible modes of the StackTraceHandler.

```go
type Mode string
```

<a name="ModeAddAttr"></a>ModeAddAttr is a mode that adds an attribute to the record.

The key name for the attribute can be overriden in KeyNameForModeAddAttr key in StackTraceHandlerOptions. The default value is defined in the KeyNameForModeAddAttrDefault constant.

```go
const ModeAddAttr Mode = "add-attr"
```

<a name="ModeNothing"></a>ModeNothing is a mode that does nothing.

```go
const ModeNothing Mode = "nothing"
```

<a name="ModePrint"></a>ModePrint is a mode that prints the stack trace to the output.

```go
const ModePrint Mode = "print"
```

<a name="ModePrintWithColors"></a>ModePrintWithColors is a mode that prints the stack trace to the output with colors.

Note that this option is only interesting when used with AddSource=true in the HandlerOptions.

```go
const ModePrintWithColors Mode = "print-colors"
```

<a name="Options"></a>
## type [Options](<https://github.com/fabien-marty/stlog-helpers/blob/main/pkg/stacktrace/stacktrace-handler.go#L63-L70>)

Options is a struct that contains the options for the StackTraceHandler.

```go
type Options struct {
    slog.HandlerOptions
    Mode                                    Mode        // The mode of the (stacktrace) Handler.
    KeyNameForModeAddAttr                   string      // The key name for the attribute in ModeAddAttr mode.
    KeyForStackTraceEnabled                 string      // The key of a boolean attribute to enable the stack trace
    MinimalLevelForStackTraceEnabledEnabled *slog.Level // The minimal level for which the stack trace is automatically enabled.
    WriterForPrint                          io.Writer   // The writer to use for ModePrint and ModePrintWithColors (default to stderr).
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
